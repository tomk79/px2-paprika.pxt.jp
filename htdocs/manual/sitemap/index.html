<p>サイトマップは、ウェブサイト全体のページ構成を定義する概念です。</p>
<p>1ページ1行の表形式で表現され、CSV または Microsoft Excel のファイル形式で編集できます。</p>
<!-- autoindex -->

<h2 id="-csv-">サイトマップCSVの格納ディレクトリ</h2>
<p>サイトマップCSVは、ホームディレクトリ(<code>px-files/</code>) の中にある、 <code>sitemaps/</code> ディレクトリ直下に格納します。</p>
<p>サイトマップは複数のCSVファイルに分割して管理することができます。 <code>px-files/sitemaps/</code> の直下にある 拡張子 <code>*.csv</code> のファイルはすべて収集され、併せて1つのサイトマップツリーとして処理されます。</p>

<h2 id="csv-">CSVの形式</h2>
<ul>
<li>CSVファイルはUTF-8で保存してください。</li>
<li>1行目は定義行として、2行目以降にページデータを記述してください。</li>
<li>定義行は、<code>* 定義名</code> のように、先頭にアスタリスクを記述します。</li>
<li><code>* path</code>、<code>* title</code> は必須です。必ず定義に加えてください。</li>
</ul>
<h3 id="-">規定の定義</h3>

<table class="def">
<colgroup>
<col style="width:9.75609756097561%;" />
<col style="width:34.14634146341464%;" />
<col style="width:56.09756097560976%;" />
</colgroup>
<thead>
<tr>
<th style="text-align: center;">列</th>
<th style="text-align: center;">キー</th>
<th style="text-align: center;">意味</th>
</tr>
</thead>
<tbody>
<tr>
<th style="text-align: center;">A</th>
<td>path</td>
<td>ページのパス</td>
</tr>
<tr>
<th style="text-align: center;">B</th>
<td>content</td>
<td>コンテンツファイルの格納先</td>
</tr>
<tr>
<th style="text-align: center;">C</th>
<td>id</td>
<td>ページID</td>
</tr>
<tr>
<th style="text-align: center;">D</th>
<td>title</td>
<td>ページタイトル</td>
</tr>
<tr>
<th style="text-align: center;">E</th>
<td>title_breadcrumb</td>
<td>ページタイトル(パン屑表示用)</td>
</tr>
<tr>
<th style="text-align: center;">F</th>
<td>title_h1</td>
<td>ページタイトル(H1表示用)</td>
</tr>
<tr>
<th style="text-align: center;">G</th>
<td>title_label</td>
<td>ページタイトル(リンク表示用)</td>
</tr>
<tr>
<th style="text-align: center;">H</th>
<td>title_full</td>
<td>ページタイトル(タイトルタグ用)</td>
</tr>
<tr>
<th style="text-align: center;">I</th>
<td>logical_path</td>
<td>論理構造上のパス</td>
</tr>
<tr>
<th style="text-align: center;">J</th>
<td>list_flg</td>
<td>一覧表示フラグ</td>
</tr>
<tr>
<th style="text-align: center;">K</th>
<td>layout</td>
<td>レイアウト</td>
</tr>
<tr>
<th style="text-align: center;">L</th>
<td>orderby</td>
<td>表示順</td>
</tr>
<tr>
<th style="text-align: center;">M</th>
<td>keywords</td>
<td>metaキーワード</td>
</tr>
<tr>
<th style="text-align: center;">N</th>
<td>description</td>
<td>metaディスクリプション</td>
</tr>
<tr>
<th style="text-align: center;">O</th>
<td>category_top_flg</td>
<td>カテゴリトップフラグ</td>
</tr>
<tr>
<th style="text-align: center;">P</th>
<td>role</td>
<td>ロール</td>
</tr>
<tr>
<th style="text-align: center;">Q</th>
<td>proc_type</td>
<td>コンテンツの処理方法</td>
</tr>
</tbody>

</table>
<h3 id="path-">path - ページのパス</h3>
<p>ページのパスを入力します。必須項目です。</p>
<p>パスは、スラッシュから始まる絶対パスで記入します。URLの origin 部分は含みません。
Pickles 2 は、ページのユニークな識別子として <code>path</code> を利用しますので、同じパスのページを複数定義することはできません。</p>
<p>もし、プロジェクト設定の <code>$conf-&gt;path_controot</code> に深い階層が設定されている場合、絶対パスの起点はこのディレクトリになります。</p>
<p><code>path</code> には、後述するエイリアスとダイナミックパスをセットすることができます。</p>
<h3 id="content-">content - コンテンツファイルの格納先</h3>
<p>コンテンツファイルのパスを入力します。省略した場合、<code>path</code> が示すパスにあるコンテンツファイルを参照します。</p>
<h3 id="id-id">id - ページID</h3>
<p>ページのIDを入力します。 <code>path</code> と同様、ページを一意に識別するための記号なので、必ずユニークな値でなければなりません。</p>
<p>ただし、省略することが可能です。省略時、 Pickles 2 が自動的に連番を含む文字列をIDとして与えます。</p>
<p>トップページは例外的に、常に 空白文字列 として定義されます。</p>
<h3 id="title-">title - ページタイトル</h3>
<p>ページのタイトルです。 titleタグや、h1タグ、パンくず、ナビゲーション上のリンクラベルなどに利用されます。</p>
<h3 id="title-_breadcrumb-">title_breadcrumb - ページタイトル(パン屑表示用)</h3>
<p>パンくず表示用のタイトル文字列です。省略時、 <code>title</code> と同じ文字列が採用されます。</p>
<h3 id="title-_h1-h1-">title_h1 - ページタイトル(H1表示用)</h3>
<p>H1タグ表示用のタイトル文字列です。省略時、 <code>title</code> と同じ文字列が採用されます。
H1タグは、他の用途と異なり、改行を表現することができるエリアです。サイトマップCSV上では改行コードを入力して改行を表現できます。テーマテンプレート上では、明示的に、改行コードを <code>&lt;br /&gt;</code> に変換して出力する必要があります。</p>
<h3 id="title-_label-">title_label - ページタイトル(リンク表示用)</h3>
<p>リンクラベル用のタイトル文字列です。省略時、 <code>title</code> と同じ文字列が採用されます。</p>
<h3 id="title-_full-">title_full - ページタイトル(タイトルタグ用)</h3>
<p>titleタグ用のタイトル文字列です。省略時、 <code>title</code> とサイト名を組み合わせて自動生成されます。</p>
<h3 id="logical-_path-">logical_path - 論理構造上のパス</h3>
<p>パンくず上のパス情報を入力します。</p>
<p>トップページと自分自身を除く間の階層のページパスまたはページIDを、 <code>&gt;</code> 記号で繋いだ形式で表現します。</p>
<h3 id="list-_flg-">list_flg - 一覧表示フラグ</h3>
<p>ローカルナビ等の一覧に表示するかしないかを決めるフラグです。 <code>1</code> をセットした場合表示され、<code>0</code> または 空白 とした場合には、表示されなくなります。</p>
<h3 id="layout-">layout - レイアウト</h3>
<p>テーマレイアウトを選択するスイッチです。任意の文字列でレイアウトを指定できます。
例えば <code>top</code> と入力した場合、テーマレイアウトの <code>top.html</code> が適用されます。</p>
<p>省略時は、 <code>default.html</code> が適用されます。</p>
<h3 id="orderby-">orderby - 表示順</h3>
<p>ページの表示順を、数値で指示します。
省略時、サイトマップCSVに記入したままの並び順になります。</p>
<h3 id="keywords-meta-">keywords - metaキーワード</h3>
<p>metaタグの keywords 文字列として利用されます。</p>
<h3 id="description-meta-">description - metaディスクリプション</h3>
<p>metaタグの description 文字列として利用されます。</p>
<h3 id="category-_top-_flg-">category_top_flg - カテゴリトップフラグ</h3>
<p><code>1</code> (=カテゴリトップページ)または <code>0</code> (=下層の通常ページ)で指定します。省略時は <code>0</code> と同じです。</p>
<p>論理階層がトップページ直下の2階層目で、かつ <code>list_flg</code> が <code>1</code> にセットされているページでは、 <code>category_top_flg</code> が <code>1</code> の場合、グローバルナビゲーションに含められ、<code>category_top_flg</code> が <code>0</code> の場合は、ショルダーナビゲーションに含められます。</p>
<h3 id="role-">role - ロール</h3>
<p>後述する アクター機能を使います。</p>
<h3 id="proc-_type-">proc_type - コンテンツの処理方法</h3>
<p><code>$conf-&gt;paths_proc_type</code> と同様の効果を、サイトマップ上で設定できます。</p>

<h2 id="-">特殊機能</h2>
<h3 id="-">エイリアス機能</h3>
<p><code>path</code> が <code>alias:</code> の後に参照先ページの <code>path</code> または <code>id</code> が続く形式の場合、そのページは 指示された参照先ページへの エイリアスとして扱われます。</p>
<p>エイリアスページは、パンくずやナビゲーション上には存在しますが、URLを持っていません。このリンクをクリックすると、エイリアスの参照先ページへ遷移します。</p>
<p>例: <code>alias:/hoge/index.html</code> = <code>/hoge/index.html</code> のエイリアス。</p>
<h3 id="-">ダイナミックパス機能</h3>
<p>パスの中に、ワイルドカード <code>{*xxxx}</code> や <code>{$xxxx}</code> を含めることで、ダイナミックパス機能を利用できます。</p>
<p>ダイナミックパスは、ワイルドカードにマッチURLのアクセスを処理します。ルーティングのような役割を果たします。</p>
<p>ワイルドカードにマッチした値は、 <code>$px-&gt;site()-&gt;get_path_param()</code> で受け取ることができます。</p>
<p>例: ダイナミックパス <code>/hoge/fuga/{*xxxx}</code> が定義されているとき、リクエスト <code>/hoge/fuga/foo/bar.html</code> を処理するとき、 <code>$px-&gt;site()-&gt;get_path_param(&#39;xxxx&#39;)</code> は、 <code>foo/bar.html</code> を返します。</p>
<p><code>xxxx</code> は任意の文字列で、1つのURLの中でユニークである必要があります。
<code>xxxx</code> に空文字を使い、 <code>{*}</code> のように使用することもできます。 この場合、 引数なしの <code>$px-&gt;site()-&gt;get_path_param()</code> で受け取ることができます。</p>
<p><code>{$xxxx}</code> は スラッシュを含まないディレクトリ名またはファイル名にマッチします。 <code>{*xxxx}</code> は、スラッシュも含めた文字列にマッチします。</p>
<h3 id="-">アクター機能</h3>
<p>ロール(<code>role</code>)列に、参照先ページの <code>path</code> または <code>id</code> が入力されている場合、そのページは参照先ページのアクター(役者)になります。</p>
<p>アクターは、URLとページコンテンツの実体を持ちますが、パンくず構造上はロール(参照先)と同じページとして振る舞います。</p>

<h2 id="-">その他のヒント</h2>
<ul>
<li>定義列は、任意に並べ替えることができます。</li>
<li>定義は任意の名称で追加することができ、コンテンツやテーマから簡単に参照できます。例えば、 <code>* custom_col</code> と定義した列の値は、<code class="selectable">$px-&gt;site()-&gt;get_page_info( &#39;page_id&#39;, &#39;custom_col&#39; )</code> や <code class="selectable">$px-&gt;site()-&gt;get_current_page_info( &#39;custom_col&#39; )</code> で取得することができます。</li>
<li>サイトマップの拡張項目 <code>* editor-comment</code> に文字列を入力しておくと、 Pickles 2 Desktop Tool のコンテンツの編集画面上に表示することができます。コンテンツを編集する担当者へのメッセージ欄として利用できます。</li>
<li>サイトマップCSVを分割した場合、ファイル名でソートされ、昇順で処理されます。 重複するページが記述されている場合、後に処理された方が有効になります。</li>
<li>サイトマップCSVを更新すると、初回アクセス時に解析され、キャッシュが作成されます。2回目以降のアクセスではキャッシュを参照するため高速ですが、初回アクセス時には応答にしばらく時間がかかることがあります。かかる時間はサイトマップに含まれるページ数に比例します。</li>
</ul>

