
ここでは、GUI編集画面で利用できるフィールド定義について説明します。


<!-- autoindex -->

## フィールドカテゴリ

フィールドには、次のカテゴリがあります。

- input
- module
- loop
- if
- echo

## inputフィールド

inputフィールドは、もっとも重要なフィールド種別で、編集可能な入力欄を埋め込みます。type属性によりさまざまな種類の入力欄を使い分けることができます。

下記は実装例です。

```html
{&{"input":{
  "type":"html",
  "name":"fieldname1",
  "label":"HTML入力欄のサンプル",
  "description": "HTMLコードを入力してください。",
  "default": "<p>入力例。</p>",
  "rows":5,
  "hidden":false
}}&}
```

下記の設定値が、ほとんどのinputフィールドで共通で利用できます。

<dl>
	<dt>type</dt>
		<dd>inputフィールドの入力欄の種類を指定します。</dd>
	<dt>name</dt>
		<dd>入力欄の物理名称を付与します。編集画面上には表示されません。この値により、コンテンツデータとフィールド情報とを関連付けるキーとして利用されますので、モジュールごとに重複のないように命名してください。 name 値を変更すると、すでに使用しているモジュールでリンクが切れ、入力した値が適用されなくなることがあるので注意してください。 <code>_ENV</code> は予約語のため、name に使用できません。</dd>
	<dt>rows</dt>
		<dd>生成される入力欄の行数を指定します。</dd>
	<dt>label</dt>
		<dd>編集画面に表示される入力欄の名称を指定します。</dd>
	<dt>hidden</dt>
		<dd>この設定に<code>true</code>を指定すると、入力欄は表示されますが、HTML上には出力されないようになります。ifフィールドやechoフィールドと組み合わせて使用する場合に、<code>true</code>をセットしてください。デフォルトは <code>false</code> です。</dd>
	<dt>description</dt>
		<dd>フィールドの説明をMarkdown形式で記述します。</dd>
	<dt>default</dt>
		<dd>デフォルトの値を設定します。値の形式は、typeごとに異なります。</dd>

</dl>


### inputフィールドの種類

`type` 属性に指定できるフィールドの種類には、次のものがあります。

- [html フィールド](./html/)
- [text フィールド](./text/)
- [markdown フィールド](./markdown/)
- [multitext フィールド](./multitext/)
- [image フィールド](./image/)
- [table フィールド](./table/)
- [html_attr_text フィールド](./html_attr_text/)
- [href フィールド](./href/)
- [select フィールド](./select/)


## moduleフィールド

moduleフィールドは、別のモジュールをネスト可能な領域を埋め込みます。

moduleフィールドを配置すると、GUI編集画面上にブルーのバーが現れ、モジュールをドラッグして追加することができるようになります。

```html
<!-- 実装例 -->
<div class="unit">
{&{"module":{"name":"main","label":"メインエリア"}}&}
<!-- /.unit --></div>
```

`name` の値により、コンテンツデータとフィールド情報とを関連付けるキーとして利用されますので、モジュールごとに重複のないように命名してください。

その他、次のオプションが利用できます。

<dl>
	<dt>hidden</dt>
		<dd>inputフィールドと同様に、 <code>hidden</code> に <code>true</code> を設定して隠し、 ifフィールド と echoフィールド を組み合わせて出力制御することができます。</dd>
	<dt>maxLength</dt>
		<dd>内包できるモジュール数の上限を設定します。</dd>
	<dt>enabledChildren</dt>
		<dd>このmoduleフィールドに内包できるモジュールのIDを指定します。文字列または配列で複数指定可能です。 パッケージ名は省略できます。</dd>
</dl>


## loopフィールド

loopフィールドは、編集者が任意の回数繰り返し記述しても良い領域を定義します。

loopフィールドを配置すると、GUI編集画面上にグリーンのバーが現れ、ダブルクリックで繰り返し領域を追加します。

```html
<!-- 実装例 -->
<ul>
{&{"loop":{"name":"thumb_loop", "label":"サムネイルリスト"}}&}
	<li>リスト</li>
{&"endloop"&}
</ul>
```

定義領域の終了は、`{&"endloop"&}` で宣言します。

`name` の値により、コンテンツデータとフィールド情報とを関連付けるキーとして利用されますので、モジュールごとに重複のないように命名してください。

その他、次のオプションが利用できます。

<dl>
	<dt>hidden</dt>
		<dd>inputフィールドと同様に、 <code>hidden</code> に <code>true</code> を設定して隠し、 ifフィールド と echoフィールド を組み合わせて出力制御することができます。</dd>
	<dt>maxLength</dt>
		<dd>内包できるモジュール数の上限を設定します。</dd>
</dl>


## if フィールド

ifフィールドは、与えた条件が真の場合にのみ、出力される領域を定義します。

条件分岐領域の終了は、`{&"endif"&}` で宣言します。

使用できる条件を説明します。

### cond

条件式を配列で指定します。

condは2次元配列です。1次元目は or 条件、2次元目は and 条件として評価されます。

```html
<!-- 実装例 -->
{&{"input":{"type":"html","name":"sample1","label":"サンプル1"}}&}
{&{"input":{"type":"html","name":"sample2","label":"サンプル2"}}&}

{&{"if":{"cond":[
	[
		"is_set:sample1",
		"sample2==123"
	]
]}}&}
<p>この部分は、sample1 に値が入力され、
  かつ sample2 に 123 を入力した場合のみ出力されます。</p>
{&"endif"&}

{&{"if":{"cond":[
	[
		"sample1==123",
		"sample2!=123"
	]
]}}&}
<p>この部分は、sample1 に 123 が入力され、
  かつ sample2 に 123 以外の値が入力された場合のみ出力されます。</p>
{&"endif"&}
```


#### 編集画面でのみ表示を切り替える

`is_mode:canvas` と `is_mode:finalize` は、編集画面描画時 または 最終描画時 の条件によって出力内容を分岐する条件として利用できます。

```html
<!-- 編集画面にのみ表示する実装例 -->
{&{"if":{"cond":[
	["is_mode:canvas"]
]}}&}
<p>この部分は、編集画面でのみ表示されます。</p>
{&"endif"&}

<!-- 編集画面には表示しない実装例 -->
{&{"if":{"cond":[
	["is_mode:finalize"]
]}}&}
<p>この部分は、最終描画時のみ表示され、
  編集画面では表示されません。</p>
{&"endif"&}
```



### is_set

指定した名前のフィールドに値がセットされている場合に、内容を表示します。

```html
<!-- 実装例 -->
{&{"input":{"type":"html","name":"sample1","label":"サンプル1"}}&}

{&{"if":{"is_set":"sample1"}}&}
<p>この部分は、sample1 に値を入力した場合のみ出力されます。</p>
{&"endif"&}
```

### elseifフィールド, elseフィールド

ifフィールドは、 elseifフィールド, elseフィールド と組み合わせて複数の条件を定義することができます。

```html
<!-- 実装例 -->
{&{"input":{"type":"html","name":"sample1","label":"サンプル1"}}&}

{&{"if":{"cond":[
	[
		"sample1==123"
	]
]}}&}
<p>この部分は、sample1 に値 123 を入力した場合のみ出力されます。</p>
{&{"elseif":{"cond":[
	[
		"sample1==456"
	]
]}}&}
<p>この部分は、sample1 に値 456 を入力した場合のみ出力されます。</p>
{&"else"&}
<p>この部分は、その他の場合のみ出力されます。</p>
{&"endif"&}
```


## echoフィールド

echoフィールドは、別のフィールドで入力された値を出力します。

```html
<!-- 実装例 -->
{&{"input":{
  "type":"html",
  "name":"sample1",
  "label":"サンプル1",
  "hidden":true
}}&}

{&{"echo":{"ref":"sample1"}}&}
```

この例は、HTML入力欄 `sample1` の値を、後で出力しています。
HTML入力欄自体は、`"hidden":true` で隠しているので、結果として、入力値は1回だけ出力されます。





