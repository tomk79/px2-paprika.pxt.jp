<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>GUI編集を使うための Pickles 2 の設定 | Pickles 2</title>

<meta property="og:site_name" content="Pickles 2" />
<meta property="og:title" content="GUI編集を使うための Pickles 2 の設定 | Pickles 2" />
<meta property="og:type" content="blog" />
<meta property="og:url" content="http://pickles2.pxt.jp/manual/guieditor/setting_pickles2/" />
<meta property="og:image" content="http://pickles2.pxt.jp/common/images/og_image.png" />
<link rel="canonical" href="http://pickles2.pxt.jp/manual/guieditor/setting_pickles2/" />
<link rel="icon" href="../../../common/images/favicon.png" type="image/png" />
<meta name="apple-mobile-web-app-capable" content="no" /><meta name="format-detection" content="telephone=no" /><link rel="apple-touch-icon" href="../../../common/images/apple-touch-icon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="keywords" content="" />
		<meta name="description" content="" />

 
<!-- jQuery -->
<script src="../../../common/scripts/jquery-1.10.1.min.js" type="text/javascript"></script>

<!-- Bootstrap -->
<link rel="stylesheet" href="../../../common/styles/bootstrap/css/bootstrap.min.css">
<script src="../../../common/styles/bootstrap/js/bootstrap.min.js"></script>

<!-- px2style -->
<link rel="stylesheet" href="../../../common/px2style/dist/styles.css" type="text/css" />
<script src="../../../common/px2style/dist/scripts.js"></script>

<!-- Contents Stylesheets -->
<link rel="stylesheet" href="../../../common/styles/contents.css" type="text/css" />

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-3100892-11', 'auto');
  ga('send', 'pageview');
</script>

		<!-- Adobe Typekit -->
		<script src="https://use.typekit.net/erd0xqv.js"></script>
		<script>try{Typekit.load({ async: true });}catch(e){}</script>

		<!-- Bootstrap Theme -->
		<link rel="stylesheet" href="../../../caches/p/theme/pickles/styles/bootstrap-theme.min.css">
		<link rel="stylesheet" href="../../../caches/p/theme/pickles/styles/theme.css">

		<!-- Font Awesome -->
		<link rel="stylesheet" href="../../../caches/p/theme/pickles/libs/font-awesome-4.6.3/css/font-awesome.min.css" />

		<!-- highlight.js -->
		<link rel="stylesheet" href="../../../caches/p/theme/pickles/libs/highlight.js/styles/github.css">
		<script src="../../../caches/p/theme/pickles/libs/highlight.js/highlight.pack.js"></script>
		<script>
			$(document).ready(function() {
				$('pre code').each(function(i, block) {
					hljs.highlightBlock(block);
				});
			});
		</script>

		<script>
			// Adobe Typekit
			$(function(){
				var mutObs = new MutationObserver(function(records, observer){
					// console.log('MutationObserver() callback');
					// console.log(records);
					// console.log(observer);

					for( var idx in records ){
						var $tgt = $(records[idx].target);
						// $tgt.find('h1,h2,h3,h4,h5,h6')
						// 	.removeClass('tk-ryo-gothic-plusn')
						// 	.removeClass('tk-skolar-sans-latin')
						// 	.addClass('tk-ryo-gothic-plusn')
						// ;
						$tgt.find('.theme_welcome h1').removeClass('tk-ryo-gothic-plusn').addClass('tk-skolar-sans-latin');
						$tgt.find('.theme_welcome p').addClass('tk-ryo-gothic-plusn');

						// $tgt.find('.theme_header').addClass('tk-ryo-gothic-plusn');
						// $tgt.find('.theme_footer').addClass('tk-ryo-gothic-plusn');
						// $tgt.find('.theme_breadcrumb').addClass('tk-ryo-gothic-plusn');
						$tgt.find('.theme_si').removeClass('tk-ryo-gothic-plusn').addClass('tk-skolar-sans-latin');
					}

				});
				mutObs.observe($('body').get(0), {
					childList: true,
					subtree: true
				});

			});
		</script>
	</head>
	<body class="default">
		<header class="theme_header" id="page_top">
			<div class="container">
				<p class="theme_si"><a href="../../../"><img src="../../../caches/p/theme/pickles/images/logo_2017.svg" alt="Pickles 2" /></a></p>
				<div class="theme_shouldernavi">
<ul><li><a href="../../../developers/">開発者向けの情報</a></li></ul>				</div>
				<div class="theme_globalnavi">
<ul><li><a href="../../../overview/about/">はじめに</a></li><li><a href="../../../download/">ダウンロード</a></li><li><a href="../../" class="current">使い方</a></li><li><a href="../../../tools/">ツール・リソース</a></li><li><a href="../../../blog/">BLOG</a></li><li><a href="../../../usergroups/">ユーザーグループ</a></li></ul>
				</div>
			</div>
		</header>
		<div class="theme_mainblock">
			<div class="container theme_common_navi_frame">
				<div class="row">
					<div class="col-sm-9">
						<div class="theme_breadcrumb"><ul><li><a href="../../../">HOME</a></li><li><a href="../../">使い方</a></li><li><a href="../">GUI編集</a></li><li><span>GUI編集を使うための Pickles 2 の設定</span></li></ul></div>
						<h1>GUI編集を使うための Pickles 2 の設定</h1>


						<div class="contents">
<p><code>broccoli-html-editor</code> によるGUI編集機能を利用するために必要な、 Pickles 2 プロジェクト の設定について説明します。</p>

<!-- == autoindex == -->
<div style="margin:2em 5%; border:1px solid #bbb; padding:1em; background:rgba(124, 124, 124, 0.05); border-radius:5px;">
<div style="margin:0; padding:0; text-align:center; font-weight:bold;">INDEX</div><ul style="margin:0; padding:0 0 0 2em;"><li style="list-style-type:disc; display:list-item;"><a href="#hash_config.php_の設定">config.php の設定</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_テーマの実装">テーマの実装</a></li></ul>
</div>
<!-- / == autoindex == -->


<span id="hash_config.php_の設定"></span><h2>config.php の設定</h2>

<ul>
<li><code>$conf-&gt;funcs-&gt;before_content</code> に、プラグイン <code>pickles2/px2-px2dthelper</code> をロードします。</li>
<li><code>$conf-&gt;plugins-&gt;px2dt</code> に、Pickles 2 アプリケーション の設定をセットします。

<ul>
<li><code>paths_module_template</code> : 連想配列で、モジュールセットのパスを設定します。</li>
<li><code>path_module_templates_dir</code> : プロジェクト固有のモジュールセットを格納するディレクトリのパスを設定します。</li>
<li><code>contents_area_selector</code> : コンテンツエリアであることを示すCSSセレクタを設定します。</li>
<li><code>contents_bowl_name_by</code> : コンテンツエリアの名称が格納されている属性名を設定します。</li>
<li><code>guieditor-&gt;path_resource_dir</code> : GUI編集で登録したリソースファイルを出力するディレクトリ。 <code>$conf-&gt;path_files</code> と同様の書式で設定します。</li>
<li><code>guieditor-&gt;path_data_dir</code> : GUI編集でデータファイルを格納するディレクトリ。 <code>$conf-&gt;path_files</code> と同様の書式で設定します。</li>
<li><code>guieditor-&gt;custom_fields</code> : GUI編集に組み込むモジュールに独自のフィールド定義を追加します。</li>
</ul></li>
<li><code>$conf-&gt;funcs-&gt;processor-&gt;html</code> に プラグイン <code>pickles2/px2-remove-attr</code> を設定します。

<ul>
<li>パブリッシュ時に <code>contents_bowl_name_by</code> に設定した属性を削除するように設定します。</li>
</ul></li>
</ul>

<p>以下に設定例を示します。</p>

<pre><code>&lt;?php
/**
 * config.php template
 */
return call_user_func( function(){

    // initialize

    /** コンフィグオブジェクト */
    $conf = new stdClass;

    // (中略)

    /**
     * funcs: Before content
     *
     * サイトマップ読み込みの後、コンテンツ実行の前に実行するプラグインを設定します。
     */
    $conf-&gt;funcs-&gt;before_content = array(

        // (中略)

        // PX=px2dthelper
        'tomk79\pickles2\px2dthelper\main::register'

        // (中略)

    );

    // (中略)

    $conf-&gt;funcs-&gt;processor-&gt;html = array(

        // 属性 data-contents-area を削除する
        'tomk79\pickles2\remove_attr\main::exec('.json_encode(array(
            "attrs"=&gt;array(
                'data-contents-area',
            ) ,
        )).')' ,

    );

    // (中略)

    // -------- config for Plugins. --------
    // その他のプラグインに対する設定を行います。
    $conf-&gt;plugins = new stdClass;

    /** config for Pickles 2 Desktop Tool. */
    $conf-&gt;plugins-&gt;px2dt = new stdClass;

    /** broccoliモジュールセットの登録 */
    $conf-&gt;plugins-&gt;px2dt-&gt;paths_module_template = [
        "PlainHTMLElements" =&gt; "./vendor/pickles2/broccoli-module-plain-html-elements/modules/",
        "FESS" =&gt; "./vendor/pickles2/broccoli-module-fess/modules/"
    ];

    /** プロジェクト固有のbroccoliモジュールディレクトリ */
    $conf-&gt;plugins-&gt;px2dt-&gt;path_module_templates_dir = "./px-files/modules/";

    /** コンテンツエリアを識別するセレクタ(複数の要素がマッチしてもよい) */
    $conf-&gt;plugins-&gt;px2dt-&gt;contents_area_selector = '[data-contents-area]';

    /** コンテンツエリアのbowl名を指定する属性名 */
    $conf-&gt;plugins-&gt;px2dt-&gt;contents_bowl_name_by = 'data-contents-area';


    /** config for GUI Editor. */
    $conf-&gt;plugins-&gt;px2dt-&gt;guieditor = new stdClass;

    /** GUI編集データディレクトリ */
    $conf-&gt;plugins-&gt;px2dt-&gt;guieditor-&gt;path_data_dir = '{$dirname}/{$filename}_files/guieditor.ignore/';

    /** GUI編集リソース出力先ディレクトリ */
    $conf-&gt;plugins-&gt;px2dt-&gt;guieditor-&gt;path_resource_dir = '{$dirname}/{$filename}_files/resources/';

    /** broccoli-html-editor のフィールド拡張 */
    $conf-&gt;plugins-&gt;px2dt-&gt;guieditor-&gt;custom_fields = array(
        'projectCustom1'=&gt;array(
            'backend'=&gt;array(
                'require' =&gt; './px-files/broccoli-fields/projectCustom1/backend.js'
            ),
            'frontend'=&gt;array(
                'file' =&gt; './px-files/broccoli-fields/projectCustom1/frontend.js',
                'function' =&gt; 'window.broccoliFieldProjectCustom1'
            ),
        ),
        'projectCustom2'=&gt;array(
            'backend'=&gt;array(
                'require' =&gt; './px-files/broccoli-fields/projectCustom2/backend.js'
            ),
            'frontend'=&gt;array(
                'file' =&gt; './px-files/broccoli-fields/projectCustom2/frontend.js',
                'function' =&gt; 'window.broccoliFieldProjectCustom2'
            ),
        ),
    );

    return $conf;
} );

</code></pre>

<span id="hash_テーマの実装"></span><h2>テーマの実装</h2>

<ul>
<li>コンテンツエリアを囲うラッパーが、 <code>$conf-&gt;plugins-&gt;px2dt-&gt;contents_area_selector</code> で設定したCSSセレクタでマッチするように実装します。

<ul>
<li><code>[data-contents-area]</code> と設定した場合、 属性 <code>data-contents-area</code> を付与します。</li>
</ul></li>
<li>コンテンツエリアを囲うラッパーに、 <code>$conf-&gt;plugins-&gt;px2dt-&gt;contents_bowl_name_by</code> に設定した属性名を与え、bowl名をセットします。

<ul>
<li><code>data-contents-area</code> と設定した場合、 <code>data-contents-area="(bowl名)"</code> のようにします。</li>
</ul></li>
</ul>

<p><code>$theme-&gt;get_attr_bowl_name_by()</code> は、 <code>$conf-&gt;plugins-&gt;px2dt-&gt;contents_bowl_name_by</code> の値を取得するメソッドです。</p>

<p>これを用いた実装例は下記の通りです。</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;!-- 中略 --&gt;

&lt;!-- head は通常通り --&gt;
&lt;?= $px-&gt;bowl()-&gt;pull('head') ?&gt;
    &lt;/head&gt;
    &lt;body&gt;

        &lt;!-- 中略 --&gt;

        &lt;!-- メインコンテンツ --&gt;
        &lt;div class="contents" &lt;?= htmlspecialchars($theme-&gt;get_attr_bowl_name_by())?&gt;="main"&gt;
&lt;?= $px-&gt;bowl()-&gt;pull() ?&gt;
        &lt;/div&gt;


        &lt;!-- カスタムコンテンツエリアを設ける場合 --&gt;
        &lt;div class="contents" &lt;?= htmlspecialchars($theme-&gt;get_attr_bowl_name_by())?&gt;="custom_bowl_name"&gt;
&lt;?= $px-&gt;bowl()-&gt;pull('custom_bowl_name') ?&gt;
        &lt;/div&gt;


        &lt;!-- 中略 --&gt;

&lt;!-- foot は通常通り --&gt;
&lt;?= $px-&gt;bowl()-&gt;pull('foot') ?&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
						</div>



					</div>
					<div class="col-sm-3">
						<nav class="theme_common_navi">
							<p><a href="../../">使い方</a></p>
<ul>
<li><a href="../../system_structure/">システムの構成</a></li>
<li><a href="../../setup/">セットアップ手順</a></li>
<li><a href="../../configs/">設定</a></li>
<li><a href="../../sitemap/">サイトマップ編集</a></li>
<li><a href="../../theme/">テーマ編集</a></li>
<li><a href="../../contents/">コンテンツ編集</a></li>
<li><a href="../../publish/">パブリッシュ</a></li>
<li><a href="../../cmd_options/">コマンドラインオプション</a></li>
<li><a href="../../plugins/">プラグイン</a></li>
<li><a href="../../pxcommands/">PXコマンド</a></li>
<li><a href="../" class="current">GUI編集</a><ul>
<li><a href="./" class="current">GUI編集を使うための Pickles 2 の設定</a></li>
<li><a href="../designing_modules/">GUIモジュール定義</a></li>
<li><a href="../designing_modules_with_tplengines/">Twigエンジンを用いたGUIモジュール定義</a></li>
<li><a href="../fields/">フィールド一覧</a></li>
<li><a href="../select_gui_engine/">GUI編集エンジンの種類と切り替え方法</a></li>
</ul>
</li>
<li><a href="../../contents_manifesto/">Contents Manifesto</a></li>
<li><a href="../../api_reference/">API リファレンス</a></li>
</ul>
						</nav>
					</div>
				</div><!-- /.row -->
			</div><!-- /.container -->
			<div class="container">
				<div class="theme_backtotop"><a href="#page_top"><i class="fa fa-arrow-up"></i> back to top</a></div>
				<div class="theme_breadcrumb"><ul><li><a href="../../../">HOME</a></li><li><a href="../../">使い方</a></li><li><a href="../">GUI編集</a></li><li><span>GUI編集を使うための Pickles 2 の設定</span></li></ul></div>
			</div><!-- /.container -->
		</div><!-- /.theme_mainblock -->
		<footer class="theme_footer">
			<div class="theme_container">
				<nav class="theme_megafooter_navi">
<ul><li><a href="../../../overview/about/">はじめに</a></li><li><a href="../../../download/">ダウンロード</a></li><li><a href="../../" class="current">使い方</a></li><li><a href="../../../tools/">ツール・リソース</a></li><li><a href="../../../blog/">BLOG</a></li><li><a href="../../../usergroups/">ユーザーグループ</a></li></ul>				</nav>
			</div>
			<div class="theme_container theme_footer_shouldernavi">
<ul><li><a href="../../../">HOME</a></li><li><a href="../../../developers/">開発者向けの情報</a></li></ul>			</div>
			<div class="theme_container theme_footer_searcher">
				<form action="../../../search/" class="form-inline">
					<div class="form-group">
						<label>サイト内検索</label>
						<input type="text" name="q" value="" class="form-control" />
						<button class="form-control">検索</button>
					</div>
				</form>
			</div>
			<div class="theme_container">
				<div class="theme_social_icons">
					<a href="https://twitter.com/pxfw" target="_blank" title="Pickles 2 on Twitter"><i class="fa fa-twitter"></i></a>
					<a href="https://github.com/pickles2" target="_blank" title="Pickles 2 on github"><i class="fa fa-github"></i></a>
				</div>
			</div>
			<div class="theme_container">
				<p style="text-align:center;">&copy;Pickles 2 Project.</p>
			</div>
		</footer>
		<script src="../../../caches/p/theme/pickles/scripts/smoothScroll.js"></script>
		<script src="../../../caches/p/theme/pickles/scripts/global.js"></script>
		<script src="../../../caches/p/theme/pickles/scripts/jquery.sidebarFix.js"></script>
		<script type="text/javascript">
			$(window).load(function(){
				$('.theme_common_navi').sidebarFix({
					'frame': $('.theme_common_navi_frame'),
					'topBuffer': 98
				});
			});
		</script>
	</body>
</html>
