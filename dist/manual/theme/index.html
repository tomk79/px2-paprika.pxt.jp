<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>テーマ編集 | Pickles 2</title>

<meta property="og:site_name" content="Pickles 2" />
<meta property="og:title" content="テーマ編集 | Pickles 2" />
<meta property="og:type" content="blog" />
<meta property="og:url" content="http://pickles2.pxt.jp/manual/theme/" />
<meta property="og:image" content="http://pickles2.pxt.jp/common/images/og_image.png" />
<link rel="canonical" href="http://pickles2.pxt.jp/manual/theme/" />
<link rel="icon" href="../../common/images/favicon.png" type="image/png" />
<meta name="apple-mobile-web-app-capable" content="no" /><meta name="format-detection" content="telephone=no" /><link rel="apple-touch-icon" href="../../common/images/apple-touch-icon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="keywords" content="" />
		<meta name="description" content="" />

 
<!-- jQuery -->
<script src="../../common/scripts/jquery-1.10.1.min.js" type="text/javascript"></script>

<!-- Bootstrap -->
<link rel="stylesheet" href="../../common/styles/bootstrap/css/bootstrap.min.css">
<script src="../../common/styles/bootstrap/js/bootstrap.min.js"></script>

<!-- px2style -->
<link rel="stylesheet" href="../../common/px2style/dist/styles.css" type="text/css" />
<script src="../../common/px2style/dist/scripts.js"></script>

<!-- Contents Stylesheets -->
<link rel="stylesheet" href="../../common/styles/contents.css" type="text/css" />

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-3100892-11', 'auto');
  ga('send', 'pageview');
</script>

		<!-- Adobe Typekit -->
		<script src="https://use.typekit.net/erd0xqv.js"></script>
		<script>try{Typekit.load({ async: true });}catch(e){}</script>

		<!-- Bootstrap Theme -->
		<link rel="stylesheet" href="../../caches/p/theme/pickles/styles/bootstrap-theme.min.css">
		<link rel="stylesheet" href="../../caches/p/theme/pickles/styles/theme.css">

		<!-- Font Awesome -->
		<link rel="stylesheet" href="../../caches/p/theme/pickles/libs/font-awesome-4.6.3/css/font-awesome.min.css" />

		<!-- highlight.js -->
		<link rel="stylesheet" href="../../caches/p/theme/pickles/libs/highlight.js/styles/github.css">
		<script src="../../caches/p/theme/pickles/libs/highlight.js/highlight.pack.js"></script>
		<script>
			$(document).ready(function() {
				$('pre code').each(function(i, block) {
					hljs.highlightBlock(block);
				});
			});
		</script>

		<script>
			// Adobe Typekit
			$(function(){
				var mutObs = new MutationObserver(function(records, observer){
					// console.log('MutationObserver() callback');
					// console.log(records);
					// console.log(observer);

					for( var idx in records ){
						var $tgt = $(records[idx].target);
						// $tgt.find('h1,h2,h3,h4,h5,h6')
						// 	.removeClass('tk-ryo-gothic-plusn')
						// 	.removeClass('tk-skolar-sans-latin')
						// 	.addClass('tk-ryo-gothic-plusn')
						// ;
						$tgt.find('.theme_welcome h1').removeClass('tk-ryo-gothic-plusn').addClass('tk-skolar-sans-latin');
						$tgt.find('.theme_welcome p').addClass('tk-ryo-gothic-plusn');

						// $tgt.find('.theme_header').addClass('tk-ryo-gothic-plusn');
						// $tgt.find('.theme_footer').addClass('tk-ryo-gothic-plusn');
						// $tgt.find('.theme_breadcrumb').addClass('tk-ryo-gothic-plusn');
						$tgt.find('.theme_si').removeClass('tk-ryo-gothic-plusn').addClass('tk-skolar-sans-latin');
					}

				});
				mutObs.observe($('body').get(0), {
					childList: true,
					subtree: true
				});

			});
		</script>
	</head>
	<body class="default">
		<header class="theme_header" id="page_top">
			<div class="container">
				<p class="theme_si"><a href="../../"><img src="../../caches/p/theme/pickles/images/logo_2017.svg" alt="Pickles 2" /></a></p>
				<div class="theme_shouldernavi">
<ul><li><a href="../../developers/">開発者向けの情報</a></li></ul>				</div>
				<div class="theme_globalnavi">
<ul><li><a href="../../overview/about/">はじめに</a></li><li><a href="../../download/">ダウンロード</a></li><li><a href="../" class="current">使い方</a></li><li><a href="../../tools/">ツール・リソース</a></li><li><a href="../../blog/">BLOG</a></li><li><a href="../../usergroups/">ユーザーグループ</a></li></ul>
				</div>
			</div>
		</header>
		<div class="theme_mainblock">
			<div class="container theme_common_navi_frame">
				<div class="row">
					<div class="col-sm-9">
						<div class="theme_breadcrumb"><ul><li><a href="../../">HOME</a></li><li><a href="../">使い方</a></li><li><span>テーマ編集</span></li></ul></div>
						<h1>テーマ編集</h1>


						<div class="contents">
<p>テーマは、ページ要素のうち、ヘッダー、フッター、ナビゲーションなど、サイト全体を通して共通の規則にしたがって生成されるべき部分を一元管理する概念です。コンテンツ領域以外のHTMLソースを自動的に生成します。</p>

<!-- == autoindex == -->
<div style="margin:2em 5%; border:1px solid #bbb; padding:1em; background:rgba(124, 124, 124, 0.05); border-radius:5px;">
<div style="margin:0; padding:0; text-align:center; font-weight:bold;">INDEX</div><ul style="margin:0; padding:0 0 0 2em;"><li style="list-style-type:disc; display:list-item;"><a href="#hash_テーマの実装と_$theme_オブジェクト">テーマの実装と $theme オブジェクト</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_テーマの格納ディレクトリ">テーマの格納ディレクトリ</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_レイアウト">レイアウト</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_テーマテンプレート内で利用可能なオブジェクト">テーマテンプレート内で利用可能なオブジェクト</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_テーマテンプレートの記述">テーマテンプレートの記述</a><ul style="margin:0; padding:0 0 0 2em;"><li style="list-style-type:disc; display:list-item;"><a href="#hash_コンテンツを出力する">コンテンツを出力する</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_コンテンツが定義したCSSやJavaScriptを出力する">コンテンツが定義したCSSやJavaScriptを出力する</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_コンテンツの環境構築_(Contents_Manifesto)">コンテンツの環境構築 (Contents Manifesto)</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_ページの情報を出力する">ページの情報を出力する</a><ul style="margin:0; padding:0 0 0 2em;"><li style="list-style-type:disc; display:list-item;"><a href="#hash_ページ名を出力する">ページ名を出力する</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_メタタグ_description_を出力する">メタタグ description を出力する</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_メタタグ_keywords_を出力する">メタタグ keywords を出力する</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_ページ名(h1用)_を出力する">ページ名(h1用) を出力する</a></li></ul></li><li style="list-style-type:disc; display:list-item;"><a href="#hash_これらを組み込んだミニマム構成">これらを組み込んだミニマム構成</a></li></ul></li><li style="list-style-type:disc; display:list-item;"><a href="#hash_テーマ固有のリソースファイルへのアクセス">テーマ固有のリソースファイルへのアクセス</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_GUI編集のためのコンテンツエリア指定">GUI編集のためのコンテンツエリア指定</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_テーマ編集でよく使うメソッド">テーマ編集でよく使うメソッド</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_サンプルコード">サンプルコード</a><ul style="margin:0; padding:0 0 0 2em;"><li style="list-style-type:disc; display:list-item;"><a href="#hash_親ページへのリンクの実装例">親ページへのリンクの実装例</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_子階層リンクの実装例">子階層リンクの実装例</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_兄弟階層リンクの実装例">兄弟階層リンクの実装例</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_パンくずの実装例">パンくずの実装例</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_グローバルメニューの実装例">グローバルメニューの実装例</a></li>
<li style="list-style-type:disc; display:list-item;"><a href="#hash_ショルダーメニューの実装例">ショルダーメニューの実装例</a></li></ul>
</li></ul>
</div>
<!-- / == autoindex == -->


<span id="hash_テーマの実装と_$theme_オブジェクト"></span><h2>テーマの実装と $theme オブジェクト</h2>

<p>テーマは、<a href="../plugins/">プラグイン</a> の1つとして実装されています。初期状態の Pickles 2 には、 <code>pickles2/px2-multitheme</code> というプラグインが設定されており、このプラグインが、テーマテンプレートの選択や切り替え、値の解決等の処理を行っています。</p>

<p><code>pickles2/px2-multitheme</code> は、 <code>$theme</code> を生成します。 <code>$theme</code> は、テーマテンプレートの名前空間で利用可能なオブジェクトで、テンプレートの実装を助ける幾つかの機能を提供しています。</p>

<p><code>pickles2/px2-multitheme</code> について詳しくは <a href="https://packagist.org/packages/pickles2/px2-multitheme" target="_blank">Packagist</a> を参照してください。</p>

<p><code>config.php</code> にある下記の部分が、 <code>pickles2/px2-multitheme</code> を設定している箇所です。</p>

<pre><code class="php">$conf-&gt;funcs-&gt;processor-&gt;html = array(

    /* 中略 */

    // テーマ
    'theme'=&gt;'tomk79\pickles2\multitheme\theme::exec('.json_encode([
        'param_theme_switch'=&gt;'THEME',
        'cookie_theme_switch'=&gt;'THEME',
        'path_theme_collection'=&gt;'./px-files/themes/',
        'attr_bowl_name_by'=&gt;'data-contents-area',
        'default_theme_id'=&gt;'pickles2'
    ]).')' ,

    /* 中略 */

);
</code></pre>

<p>このドキュメントでは、 <code>pickles2/px2-multitheme</code> が導入されていることを前提に、テーマの取り扱い方法について説明します。</p>

<span id="hash_テーマの格納ディレクトリ"></span><h2>テーマの格納ディレクトリ</h2>

<p>テーマは、次のディレクトリに格納されます。</p>

<pre><code class="bash">./px-files/themes/{$テーマ名}/
</code></pre>

<p><code>{$テーマ名}</code> に該当するフォルダ名を任意に設定することで、複数のテーマを格納し、切り替えて使用することができます。テーマ名は パラメータ <code>?THEME={$テーマ名}</code> を付加することで切り替えることができます。デフォルトのテーマ名は <code>pickles2</code> で、 <code>default_theme_id</code> オプションで変更することができます。</p>

<p>テーマ格納フォルダのパスは、<code>pickles2/px2-multitheme</code> の <code>path_theme_collection</code> オプションで、切り替えに使用するパラメータ名は <code>param_theme_switch</code> で、デフォルトのテーマ名は <code>default_theme_id</code> で、それぞれ変更することができます。</p>

<!--

### 複数のテーマの管理と切り替え

Pickles Framework では、1サイトに複数のテーマを定義することができます。テーマにはそれぞれ名前を付けます。デフォルトのテーマのテーマ名は <code>&quot;default&quot;</code> です。

テーマは、URLパラメータに <code>?THEME={$テーマ名}</code> と付加して切り替えることができます。

<div class="unit">
    <div><pre><code>例： http://xxxxxxxxx/?THEME={$テーマ名}
</code></pre></div>
</div>

-->

<span id="hash_レイアウト"></span><h2>レイアウト</h2>

<p>各テーマには、それぞれ <em>レイアウト</em> と呼ばれるテンプレートを複数定義することができます。サイトマップの <code>layout</code> 列にレイアウト名を指定することによって切り替えることができます。 <code>layout</code> 列を空白にした場合は、デフォルトのレイアウト <code>default</code> が適用されます。</p>

<pre><code class="bash">./px-files/themes/{$テーマ名}/{$レイアウト名}.html
</code></pre>

<p>初期状態では、<code>default</code>(標準レイアウト)、<code>top</code>(トップページ用レイアウト)、<code>plain</code>(<code>&lt;body&gt;</code>の直下にコンテンツエリアを配したレイアウト)、<code>popup</code>(ポップアップウィンドウ用レイアウト)、<code>naked</code>(コンテンツエリアのみが出力されるレイアウト)が定義されていますが、任意に増やすことができます。</p>

<p>例えば、任意の新しいレイアウト <code>fullcolumn</code> を追加したい場合の手順は2ステップです。</p>

<ol>
<li>まず、テーマフォルダに <code>fullcolumn.html</code> を作成してテンプレートを実装します。</li>
<li>次に、サイトマップ上の適用させたいページの <code>layout</code> 列に <code>fullcolumn</code> と指定します。</li>
</ol>

<p>これで、新しいレイアウトを利用することができます。</p>

<span id="hash_テーマテンプレート内で利用可能なオブジェクト"></span><h2>テーマテンプレート内で利用可能なオブジェクト</h2>

<p>テーマテンプレートでは、次のオブジェクトが利用できます。</p>

<ul>
<li><code>$px</code> : Pickles Framework の機能を格納したオブジェクトです。コンテンツ内で呼び出せる <code>$px</code> と同じです。</li>
<li><code>$theme</code> : 前述のプラグイン <code>pickles2/px2-multitheme</code> が提供する機能を格納しています。</li>
</ul>

<span id="hash_テーマテンプレートの記述"></span><h2>テーマテンプレートの記述</h2>

<p>テーマは、コンテンツ領域のソースを変数として受け取り、HTML全体を補完して完成させます。テーマのテンプレートは、DOCTYPE宣言、htmlタグ、headセクション、bodyセクションを出力し、ヘッダー、フッターナビゲーション構造などを生成するのもテーマの役割です。</p>

<p>この章では、基本的なテーマテンプレートの実装手順について、順を追って紹介します。</p>

<p>まず、デフォルトレイアウト <code>default.html</code> に、最低限の基本的なHTMLのセットを用意します。</p>

<pre><code class="html">&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8" /&gt;
&lt;title&gt;sample&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>ここに、順を追って必要な動的要素を追加していきます。</p>

<span id="hash_コンテンツを出力する"></span><h3>コンテンツを出力する</h3>

<p>コンテンツは、コンテンツ領域にあたる部分に出力します。関数 <code>$px-&gt;bowl()-&gt;get_clean()</code> で出力でします。<br />
コンテンツ領域は、必ず <code>class="contents"</code> の要素で囲われるようにしなければなりません。<br /></p>

<pre><code class="html">&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8" /&gt;
&lt;title&gt;sample&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class="contents"&gt;
&lt;?php
    //↓コンテンツから受け取った
    //  コンテンツエリアのソースを出力しています。
    print $px-&gt;bowl()-&gt;get_clean();
?&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<span id="hash_コンテンツが定義したCSSやJavaScriptを出力する"></span><h3>コンテンツが定義したCSSやJavaScriptを出力する</h3>

<p>コンテンツは、そのコンテンツ独自のJavaScript機能やCSSを定義しているかも知れません。CSSやJavaScriptの定義は、headセクション内に出力したいところですが、コンテンツのコードにはheadセクションを含まないので、コンテンツの制作者は関数 <code>$px-&gt;bowl()-&gt;put('HTMLコード', 'head')</code> を使って、テーマにHTMLを託します。</p>

<p>こうして受け取ったコードは、次の例のように、関数 <code>$px-&gt;bowl()-&gt;get_clean('head')</code> で出力します。</p>

<p>同様に、bodyセクションの最後にコードを出力したい場合は、 <code>$px-&gt;bowl()-&gt;get_clean('foot')</code> にコードが渡されるので、あわせて出力するようにします。 <code>foot</code> には主に <code>&lt;script&gt;</code> タグなどが渡されます。</p>

<pre><code class="html">&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8" /&gt;
&lt;title&gt;sample&lt;/title&gt;
&lt;?php
    //↓コンテンツから受け取った
    //  headセクション内用のソースを出力しています。
    print $px-&gt;bowl()-&gt;get_clean('head');
?&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class="contents"&gt;
&lt;?php
    //↓コンテンツから受け取った
    //  コンテンツエリアのソースを出力しています。
    print $px-&gt;bowl()-&gt;get_clean();
?&gt;
&lt;/div&gt;
&lt;?php
    //↓コンテンツから受け取った
    //  bodyセクションの最後に出力するソースを出力しています。
    print $px-&gt;bowl()-&gt;get_clean('foot');
?&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<span id="hash_コンテンツの環境構築_(Contents_Manifesto)"></span><h3>コンテンツの環境構築 (Contents Manifesto)</h3>

<p>コンテンツのHTMLコードが本来の意図通りにレイアウトされるためには、それに必要なCSSなどの環境をテーマから提供する必要があります。しかし、コンテンツ向けのCSS環境はプロジェクトによって一定とは限りません。</p>

<p>そこで「プロジェクトは、コンテンツ向けに提供する環境設定を <code>/common/contents_manifesto.ignore.php</code> に置く」という約束が設けられました。すべてのテーマがこのファイルをインクルードすれば、テーマを取り替えたときにもコンテンツの表示を保証できるようになります。</p>

<pre><code class="html">&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8" /&gt;
&lt;title&gt;sample&lt;/title&gt;
&lt;?php
    // ↓コンテンツの環境構築を読み込みます。
    print $px-&gt;get_contents_manifesto();
?&gt;
&lt;?php
    //↓コンテンツから受け取った
    //  headセクション内用のソースを出力しています。
    print $px-&gt;bowl()-&gt;get_clean('head');
?&gt;
&lt;/head&gt;
&lt;body&gt;

...以下省略
</code></pre>

<p>Contents Manifesto のパスは、 <code>$conf-&gt;contents_manifesto</code> で設定変更可能なため、必ず同じパスに存在するとは限りません。 <code>$px-&gt;get_contents_manifesto()</code> は、この設定を考慮しつつ、解決されたHTMLソースとして Contents Manifesto を返します。</p>

<span id="hash_ページの情報を出力する"></span><h3>ページの情報を出力する</h3>

<p>カレントページの情報は、サイトマップCSVに定義されており、<code>$px-&gt;site()-&gt;get_current_page_info()</code> から取得することができます。</p>

<pre><code class="html">&lt;?= $px-&gt;site()-&gt;get_current_page_info('表示したい項目の物理名') ?&gt;
</code></pre>

<p>引数に項目の物理名を指定して、ページ情報のどの項目を表示するかを決めます。 例えば、 ページのタイトルを表示する場合、 <code>&lt;?= $px-&gt;site()-&gt;get_current_page_info('title') ?&gt;</code> のようにします。</p>

<p>幾つか例を示します。</p>

<span id="hash_ページ名を出力する"></span><h4>ページ名を出力する</h4>

<p>ページ名には、HTMLの特殊文字が含まれている可能性があります。 <code>htmlspecialchars()</code> を通して、エスケープするようにします。</p>

<pre><code class="html">&lt;title&gt;&lt;?= htmlspecialchars( $px-&gt;site()-&gt;get_current_page_info('title_full') ); ?&gt;&lt;/title&gt;
</code></pre>

<span id="hash_メタタグ_description_を出力する"></span><h4>メタタグ description を出力する</h4>

<pre><code class="html">&lt;meta name="description" content="&lt;?= htmlspecialchars($px-&gt;site()-&gt;get_current_page_info('description')); ?&gt;" /&gt;
</code></pre>

<span id="hash_メタタグ_keywords_を出力する"></span><h4>メタタグ keywords を出力する</h4>

<pre><code class="html">&lt;meta name="keywords" content="&lt;?= htmlspecialchars($px-&gt;site()-&gt;get_current_page_info('keywords')); ?&gt;" /&gt;
</code></pre>

<span id="hash_ページ名(h1用)_を出力する"></span><h4>ページ名(h1用) を出力する</h4>

<p>他の幾つかのCMSでは、h1見出しはコンテンツ(記事など)に含まれることがありますが、 Pickles 2 では、これはテーマに含むとするのが基本的な考え方です。 h1見出しは統一されたスタイルで統一された位置に表示されること、ユーザーがアクセスしたページが何かを示すh1見出しはナビゲーション構造を成立させるために不可欠な要素であることがその理由です。</p>

<p>h1見出しの実装は少し特殊です。文字列に改行が含まれている場合があるからです。 HTML特殊文字に加え、改行コードを改行タグに置き換える必要があります。</p>

<pre><code class="html">&lt;h1&gt;&lt;?= preg_replace('/\r\n|\r|\n/s', '&lt;br /&gt;', htmlspecialchars($px-&gt;site()-&gt;get_current_page_info('title_h1')) ); ?&gt;&lt;/h1&gt;
</code></pre>

<p>この他にも、サイトマップに定義されたすべての項目にアクセスすることができます。</p>

<span id="hash_これらを組み込んだミニマム構成"></span><h3>これらを組み込んだミニマム構成</h3>

<pre><code class="html">&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8" /&gt;
&lt;title&gt;&lt;?= htmlspecialchars($px-&gt;site()-&gt;get_current_page_info('title_full')); ?&gt;&lt;/title&gt;
&lt;meta name="description" content="&lt;?= htmlspecialchars($px-&gt;site()-&gt;get_current_page_info('description')); ?&gt;" /&gt;
&lt;meta name="keywords" content="&lt;?= htmlspecialchars($px-&gt;site()-&gt;get_current_page_info('keywords')); ?&gt;" /&gt;
&lt;?php
    // ↓コンテンツの環境構築を読み込みます。
    print $px-&gt;get_contents_manifesto();
?&gt;
&lt;?php
    //↓コンテンツから受け取った
    //  headセクション内用のソースを出力しています。
    print $px-&gt;bowl()-&gt;get_clean('head');
?&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;&lt;?= preg_replace('/\r\n|\r|\n/s', '&lt;br /&gt;', htmlspecialchars($px-&gt;site()-&gt;get_current_page_info('title_h1')) ); ?&gt;&lt;/h1&gt;
&lt;div class="contents"&gt;
&lt;?php
    //↓コンテンツから受け取った
    //  コンテンツエリアのソースを出力しています。
    print $px-&gt;bowl()-&gt;get_clean();
?&gt;
&lt;/div&gt;
&lt;?php
    //↓コンテンツから受け取った
    //  bodyセクションの最後に出力するソースを出力しています。
    print $px-&gt;bowl()-&gt;get_clean('foot');
?&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<span id="hash_テーマ固有のリソースファイルへのアクセス"></span><h2>テーマ固有のリソースファイルへのアクセス</h2>

<p>テーマは、それぞれ固有のリソースファイル(CSS, JavaScript, 画像など)を持つことができます。</p>

<p>テーマ固有のリソースファイルは、テーマと合わせてインストールされる必要があるため、テーマパッケージの中に格納されます。このため、テーマリソースはブラウザから直接アクセスできないパスに置かれることになります。 このパスにアクセスするには、メソッド <code>$theme-&gt;files()</code> を使います。</p>

<pre><code class="php">&lt;img src="&lt;?= htmlspecialchars( $theme-&gt;files('/path/to/resource.png') ) ?&gt;" /&gt;
</code></pre>

<p>この実装例は、 <code>$theme-&gt;files($resource_path)</code> を介して <code>&lt;theme&gt;/theme_files/path/to/resource.png</code> を呼び出しています。</p>

<p><code>$theme-&gt;files($resource_path)</code> は、 <code>theme_files</code> フォルダ内からリソースを取り出し、公開キャッシュフォルダにコピーし、キャッシュファイルのリンクを返します。 従ってブラウザは、キャッシュを読み込んで表示することになります。</p>

<span id="hash_GUI編集のためのコンテンツエリア指定"></span><h2>GUI編集のためのコンテンツエリア指定</h2>

<p><a href="../../tools/px2dt/">Pickles 2 アプリケーション</a> のGUI編集機能は、HTML上の属性値からコンテンツエリアを識別します。</p>

<p>デフォルトでは、セレクタ <code>.contents</code> でマッチする要素をbowl(コンテンツエリア)として扱い、各bowlの名前は要素の <code>id</code> 属性値から採用します(<code>id</code>属性がない場合は、<code>main</code>が省略されているものとします)。</p>

<p>この挙動は、 Pickles 2 プロジェクトの共有設定(コンフィグ)で変更することができます。次の例は、属性 <code>data-contents-area</code> がある要素をbowlとし、その値を bowl名 と解釈するようにしたものです。 初期状態の Pickles 2 プロジェクトの共有設定(コンフィグ)では、この値で設定されています。</p>

<pre><code class="html">&lt;?php
// config.php

$conf-&gt;plugins-&gt;px2dt-&gt;contents_area_selector = '[data-contents-area]';//←コンテンツエリアを識別するセレクタ(複数の要素がマッチしてもよい)
$conf-&gt;plugins-&gt;px2dt-&gt;contents_bowl_name_by = 'data-contents-area';//←コンテンツエリアのbowl名を指定する属性名
</code></pre>

<p>次の例は、テーマの実装例です。 <code>$conf-&gt;plugins-&gt;px2dt-&gt;contents_bowl_name_by</code> に設定された属性名に、 bowl の名前(この例では <code>main</code>) を指定しています。 <code>$px-&gt;bowl()-&gt;get_clean()</code> の引数を省略した場合のデフォルト値は <code>main</code> なので、 <code>$px-&gt;bowl()-&gt;get_clean('main')</code> のように明記することもできます。</p>

<pre><code class="html">&lt;div &lt;?= htmlspecialchars( $theme-&gt;get_attr_bowl_name_by() )?&gt;="main"&gt;
&lt;?= $px-&gt;bowl()-&gt;get_clean() ?&gt;
&lt;/div&gt;
</code></pre>

<p>GUI編集にかかる設定や実装について詳しくは <a href="../guieditor/setting_pickles2/">GUI編集を使うための Pickles 2 の設定</a> も参照してください。</p>

<span id="hash_テーマ編集でよく使うメソッド"></span><h2>テーマ編集でよく使うメソッド</h2>

<ul>
<li><a href="../../phpdoc/px-fw-2.x/classes/picklesFramework2.site.html#method_get_current_page_info" target="_blank">$px->site()->get_current_page_info()</a> - 現在のページの情報を得る。</li>
<li><a href="../../phpdoc/px-fw-2.x/classes/picklesFramework2.site.html#method_get_page_info" target="_blank">$px->site()->get_page_info()</a> - ページ情報を取得する。</li>
<li><a href="../../phpdoc/px-fw-2.x/classes/picklesFramework2.site.html#method_get_children" target="_blank">$px->site()->get_children()</a> - 子階層のページの一覧を取得する。</li>
<li><a href="../../phpdoc/px-fw-2.x/classes/picklesFramework2.site.html#method_get_bros" target="_blank">$px->site()->get_bros()</a> - 同じ階層のページの一覧を取得する。</li>
<li><a href="../../phpdoc/px-fw-2.x/classes/picklesFramework2.site.html#method_get_parent" target="_blank">$px->site()->get_parent()</a> - 親ページのIDを取得する。</li>
<li><a href="../../phpdoc/px-fw-2.x/classes/picklesFramework2.site.html#method_get_breadcrumb_array" target="_blank">$px->site()->get_breadcrumb_array()</a> - パンくず配列を取得する。</li>
<li><a href="../../phpdoc/px-fw-2.x/classes/picklesFramework2.site.html#method_get_global_menu" target="_blank">$px->site()->get_global_menu()</a> - グローバルメニューのページID一覧を取得する。</li>
<li><a href="../../phpdoc/px-fw-2.x/classes/picklesFramework2.site.html#method_get_shoulder_menu" target="_blank">$px->site()->get_shoulder_menu()</a> - ショルダーメニューのページID一覧を取得する。</li>
<li><a href="../../phpdoc/px-fw-2.x/classes/picklesFramework2.px.html#method_mk_link" target="_blank">$px->mk_link()</a> - リンクタグ(aタグ)を生成する。</li>
<li><a href="../../phpdoc/px-fw-2.x/classes/picklesFramework2.px.html#method_href" target="_blank">$px->href()</a> - リンク先のパスを生成する。</li>
<li><a href="../../phpdoc/px2-multitheme/classes/tomk79.pickles2.multitheme.template_utility.html#method_files" target="_blank">$theme->files()</a> - テーマリソースへのパスを取得する</li>
</ul>

<span id="hash_サンプルコード"></span><h2>サンプルコード</h2>

<span id="hash_親ページへのリンクの実装例"></span><h3>親ページへのリンクの実装例</h3>

<pre><code class="html">&lt;p&gt;&lt;?php
    $parent = $px-&gt;site()-&gt;get_parent();
    print $px-&gt;mk_link( $parent );
?&gt;&lt;/p&gt;
</code></pre>

<span id="hash_子階層リンクの実装例"></span><h3>子階層リンクの実装例</h3>

<pre><code class="html">&lt;ul&gt;&lt;?php
    $children = $px-&gt;site()-&gt;get_children();
    foreach( $children as $child ){
        print '&lt;li&gt;'.$px-&gt;mk_link( $child ).'&lt;/li&gt;';
    }
?&gt;&lt;/ul&gt;
</code></pre>

<span id="hash_兄弟階層リンクの実装例"></span><h3>兄弟階層リンクの実装例</h3>

<pre><code class="html">&lt;ul&gt;&lt;?php
    $bros = $px-&gt;site()-&gt;get_bros();
    foreach( $bros as $bro ){
        print '&lt;li&gt;'.$px-&gt;mk_link( $bro ).'&lt;/li&gt;';
    }
?&gt;&lt;/ul&gt;
</code></pre>

<span id="hash_パンくずの実装例"></span><h3>パンくずの実装例</h3>

<pre><code class="html">&lt;div class="breadcrumb"&gt;
    &lt;ul&gt;&lt;?php
    // $site-&gt;get_breadcrumb_array() は、カレントページのパンくず配列を返します。
    $breadcrumb = $px-&gt;site()-&gt;get_breadcrumb_array();
    foreach( $breadcrumb as $pid ){
        print '&lt;li&gt;';
        if( $px-&gt;href($pid) != $px-&gt;href($px-&gt;site()-&gt;get_current_page_info('id')) ){
            print $px-&gt;mk_link( $pid, array('label'=&gt;$px-&gt;site()-&gt;get_page_info($pid, 'title_breadcrumb'), 'current'=&gt;false) );
        }else{
            print '&lt;span&gt;'.htmlspecialchars( $px-&gt;site()-&gt;get_page_info($pid, 'title_breadcrumb') ).'&lt;/span&gt;';
        }
        print '&lt;/li&gt;';
    }
    // $breadcrumb はカレントページ自身を含まないため、最後に自身を追加する。
    print '&lt;li&gt;&lt;span&gt;'.htmlspecialchars( $px-&gt;site()-&gt;get_current_page_info('title_breadcrumb') ).'&lt;/span&gt;&lt;/li&gt;';
?&gt;&lt;/ul&gt;
&lt;/div&gt;
</code></pre>

<span id="hash_グローバルメニューの実装例"></span><h3>グローバルメニューの実装例</h3>

<pre><code class="html">&lt;ul&gt;&lt;?php
    $global_menu = $px-&gt;site()-&gt;get_global_menu();

    foreach( $global_menu as $global_menu_page_id ){
        print '&lt;li&gt;'.$px-&gt;mk_link( $global_menu_page_id ).'&lt;/li&gt;';
    }
?&gt;&lt;/ul&gt;
</code></pre>

<span id="hash_ショルダーメニューの実装例"></span><h3>ショルダーメニューの実装例</h3>

<pre><code class="html">&lt;ul&gt;&lt;?php
    $shoulder_menu = $px-&gt;site()-&gt;get_shoulder_menu();

    foreach( $shoulder_menu as $shoulder_menu_page_id ){
        print '&lt;li&gt;'.$px-&gt;mk_link( $shoulder_menu_page_id ).'&lt;/li&gt;';
    }
?&gt;&lt;/ul&gt;
</code></pre>
						</div>



					</div>
					<div class="col-sm-3">
						<nav class="theme_common_navi">
							<p><a href="../">使い方</a></p>
<ul>
<li><a href="../system_structure/">システムの構成</a></li>
<li><a href="../setup/">セットアップ手順</a></li>
<li><a href="../configs/">設定</a></li>
<li><a href="../sitemap/">サイトマップ編集</a></li>
<li><a href="./" class="current">テーマ編集</a></li>
<li><a href="../contents/">コンテンツ編集</a></li>
<li><a href="../publish/">パブリッシュ</a></li>
<li><a href="../cmd_options/">コマンドラインオプション</a></li>
<li><a href="../plugins/">プラグイン</a></li>
<li><a href="../pxcommands/">PXコマンド</a></li>
<li><a href="../guieditor/">GUI編集</a></li>
<li><a href="../contents_manifesto/">Contents Manifesto</a></li>
<li><a href="../api_reference/">API リファレンス</a></li>
</ul>
						</nav>
					</div>
				</div><!-- /.row -->
			</div><!-- /.container -->
			<div class="container">
				<div class="theme_backtotop"><a href="#page_top"><i class="fa fa-arrow-up"></i> back to top</a></div>
				<div class="theme_breadcrumb"><ul><li><a href="../../">HOME</a></li><li><a href="../">使い方</a></li><li><span>テーマ編集</span></li></ul></div>
			</div><!-- /.container -->
		</div><!-- /.theme_mainblock -->
		<footer class="theme_footer">
			<div class="theme_container">
				<nav class="theme_megafooter_navi">
<ul><li><a href="../../overview/about/">はじめに</a></li><li><a href="../../download/">ダウンロード</a></li><li><a href="../" class="current">使い方</a></li><li><a href="../../tools/">ツール・リソース</a></li><li><a href="../../blog/">BLOG</a></li><li><a href="../../usergroups/">ユーザーグループ</a></li></ul>				</nav>
			</div>
			<div class="theme_container theme_footer_shouldernavi">
<ul><li><a href="../../">HOME</a></li><li><a href="../../developers/">開発者向けの情報</a></li></ul>			</div>
			<div class="theme_container theme_footer_searcher">
				<form action="../../search/" class="form-inline">
					<div class="form-group">
						<label>サイト内検索</label>
						<input type="text" name="q" value="" class="form-control" />
						<button class="form-control">検索</button>
					</div>
				</form>
			</div>
			<div class="theme_container">
				<div class="theme_social_icons">
					<a href="https://twitter.com/pxfw" target="_blank" title="Pickles 2 on Twitter"><i class="fa fa-twitter"></i></a>
					<a href="https://github.com/pickles2" target="_blank" title="Pickles 2 on github"><i class="fa fa-github"></i></a>
				</div>
			</div>
			<div class="theme_container">
				<p style="text-align:center;">&copy;Pickles 2 Project.</p>
			</div>
		</footer>
		<script src="../../caches/p/theme/pickles/scripts/smoothScroll.js"></script>
		<script src="../../caches/p/theme/pickles/scripts/global.js"></script>
		<script src="../../caches/p/theme/pickles/scripts/jquery.sidebarFix.js"></script>
		<script type="text/javascript">
			$(window).load(function(){
				$('.theme_common_navi').sidebarFix({
					'frame': $('.theme_common_navi_frame'),
					'topBuffer': 98
				});
			});
		</script>
	</body>
</html>
